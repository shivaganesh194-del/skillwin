// payment.js
// THIS FILE TRIGGERS RAZORPAY PAYMENT

function startPayment() {
  const options = {
    key: "rzp_test_S5ix2RrfFFJITe", // keep this or it can come from backend
    amount: 1000, // ‚Çπ10 in paise
    currency: "INR",
    name: "SkillWin",
    description: "Skill Based Contest Entry",
    image: "https://your-logo-url.png",

    // üî¥ FORCE ONLY UPI (NO PAY LATER)
    method: {
      upi: true,
      card: false,
      netbanking: false,
      wallet: false,
      emi: false,
      paylater: false
    },

    handler: async function (response) {
      alert("HANDLER CALLED ‚úÖ"); // DO NOT REMOVE (for testing)

      console.log("Payment Success:", response);

      // üîπ Call backend to create ticket
      const res = await fetch("/api/create-ticket", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          razorpay_payment_id: response.razorpay_payment_id
        })
      });

      const data = await res.json();

      if (data.success) {
        alert("TICKET GENERATED üéüÔ∏è");

        // SHOW SUCCESS + WHATSAPP
        document.getElementById("entry-success").style.display = "block";
      } else {
        alert("Ticket creation failed");
      }
    },

    theme: {
      color: "#2563eb"
    }
  };

  const rzp = new Razorpay(options);
  rzp.open();
}

// üîπ Button hookup (DO NOT CHANGE ID)
document.getElementById("payNowBtn").addEventListener("click", startPayment);
