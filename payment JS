<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
async function startPayment() {
  // 1Ô∏è‚É£ Create order from backend (Vercel)
  const response = await fetch("/api/create-order", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      amount: 10, // Rs.10
      contest_id: "SCIENCE_CONTEST_001"
    })
  });

  const data = await response.json();

  if (!data.order_id) {
    alert("Unable to create order. Try again.");
    return;
  }

  // 2Ô∏è‚É£ Razorpay options ‚Äì UPI ONLY
  const options = {
    key: "rzp_test_S5ix2RrfFFJITe", // test or live
    amount: data.amount,
    currency: "INR",
    name: "Science Mega Contest",
    description: "Answer & Win",
    order_id: data.order_id,

    method: {
      upi: true,
      card: false,
      netbanking: false,
      wallet: false,
      emi: false,
      paylater: false
    },

    handler: async function (response) {
      // 3Ô∏è‚É£ Save payment + ticket
      await fetch("/api/payment-success", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          order_id: data.order_id,
          payment_id: response.razorpay_payment_id
        })
      });

      // 4Ô∏è‚É£ Success message
      document.body.innerHTML = `
        <h2>üéâ Payment Successful!</h2>
        <p>Your ticket has been generated.</p>
        <p><b>You are the winner*</b></p>
        <p>Final results will be notified shortly.</p>
        <p>Terms & Conditions applied.</p>
      `;
    },

    theme: {
      color: "#0f172a"
    }
  };

  const rzp = new Razorpay(options);
  rzp.open();
}
</script>
